#!/usr/bin/env zsh
# zmodload zsh/zprof

export DOTFILES=$HOME/.dotfiles

# ensure to only execute on ZSH
[ ! -n "$ZSH_VERSION" ] && return

# autoloaded functions (lazy loading)
zsh_fpath=$DOTFILES/autoloaded
fpath=($zsh_fpath $fpath)

if [[ -d "$zsh_fpath" ]]; then
    for func in $zsh_fpath/*; do
        autoload -Uz ${func:t}
    done
fi
unset zsh_fpath

# Plugins
source ~/.zsh_plugins.sh

# load scripts
zsh_fpath=$DOTFILES/zsh/dots
if [[ -d "$zsh_fpath" ]]; then
    for file in $zsh_fpath/*.zsh; do
        source $file
    done
fi
unset zsh_fpath

[ -f ~/.local.zsh ] && source ~/.local.zsh

# source fuzzy file search - fzf
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# Prevent duplicates in PATH
typeset -U path
export PATH

autoload -Uz compinit
if [ $(date +'%j') != $(/usr/bin/stat -f '%Sm' -t '%j' ${ZDOTDIR:-$HOME}/.zcompdump) ]; then
  compinit;
else
  compinit -C;
fi
# zprof
