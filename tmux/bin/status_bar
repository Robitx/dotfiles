#!/usr/bin/env bash
# Responsive tmux status bar

WIDTH=${1}
SMALL=100
TMUX_BIN="$DOTFILES/tmux/bin"

BAR+="#($TMUX_BIN/mail_count_apple)"

TUNE=$("$TMUX_BIN/now_playing" "$WIDTH")

[[ -n $TUNE ]] && \
  BAR+="#[fg=colour74]#($TMUX_BIN/now_playing $WIDTH)#[default]"

if [[ $WIDTH -ge 120 ]]; then
  BAR+="#($TMUX_BIN/ip_info)#[default]"
fi

if [[ -n $TUNE ]] && [[ $WIDTH -le $SMALL ]]; then
  BAR+=" #(tmux-mem-cpu-load -a 0 -g 0 -i 2 -t 0)"
else
  BAR+=" #(tmux-mem-cpu-load -a 0 -g 10 -i 2 -t 0)"
fi

CPU="$($TMUX_BIN/osx-cpu-temp)"
CPU_TEMP="${CPU:0:2}"
if [[ $CPU_TEMP -ge 90 ]]; then
  CPU_COLOR="160"
elif [[ $CPU_TEMP -ge 80 ]]; then
  CPU_COLOR="202"
elif [[ $CPU_TEMP -ge 70 ]]; then
  CPU_COLOR="172"
else
  CPU_COLOR="178"
fi
BAR+=" #[fg=colour$CPU_COLOR]#($TMUX_BIN/osx-cpu-temp)"
BAR+="#($TMUX_BIN/internet_info)#[default]"

printf '%s' "$BAR"
